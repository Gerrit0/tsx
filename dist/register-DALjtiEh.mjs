import p from"node:module";import{MessageChannel as c}from"node:worker_threads";const i=r=>{const{sourceMapsEnabled:t}=process;process.setSourceMapsEnabled(!0);const{port1:e,port2:s}=new c;return p.register(`./esm/index.mjs?${Date.now()}`,{parentURL:import.meta.url,data:{namespace:r?.namespace,port:s},transferList:[s]}),()=>(e.postMessage("deactivate"),t===!1&&process.setSourceMapsEnabled(!1),new Promise(a=>{const o=n=>{n==="deactivated"&&a()};e.on("message",o),e.unref()}))};export{i as r};
