import p from"node:module";import{MessageChannel as c}from"node:worker_threads";const m=o=>{const{sourceMapsEnabled:a}=process;process.setSourceMapsEnabled(!0);const{port1:e,port2:t}=new c;if(p.register(`./esm/index.mjs?${Date.now()}`,{parentURL:import.meta.url,data:{namespace:o?.namespace,port:t},transferList:[t]}),o?.onImport){const{onImport:r}=o;e.on("message",s=>{s.type==="load"&&r(s.url)}),e.unref()}return()=>(a===!1&&process.setSourceMapsEnabled(!1),e.postMessage("deactivate"),new Promise(r=>{const s=n=>{n.type==="deactivated"&&(console.log(22222),r(),e.off("message",s))};e.on("message",s),e.unref(),console.log(4)}))};export{m as r};
