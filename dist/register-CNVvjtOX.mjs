import c from"node:module";import{MessageChannel as m}from"node:worker_threads";const f=a=>{const{sourceMapsEnabled:n}=process;process.setSourceMapsEnabled(!0);const{port1:e,port2:o}=new m;c.register(`./esm/index.mjs?${Date.now()}`,{parentURL:import.meta.url,data:{namespace:a?.namespace,port:o},transferList:[o]});const s=a?.onImport&&(t=>{t.type==="load"&&a.onImport(t.url)});return s&&e.on("message",s),()=>(n===!1&&process.setSourceMapsEnabled(!1),s&&e.off("message",s),e.postMessage("deactivate"),new Promise(t=>{const r=p=>{p.type==="deactivated"&&(console.log(22222),t(),e.off("message",r))};e.on("message",r)}))};export{f as r};
