import i from"node:module";import{s as d,i as p,f as v,a as T,t as x,b,r as j,c as F,d as O,l as S}from"./resolve-ts-path-DUkQ8uuR.mjs";import M from"node:fs";import{p as g,t as P,a as R}from"./index-CKNv86dv.mjs";import{p as u}from"./client-Cg7nS93t.mjs";import h from"node:path";import{fileURLToPath as A}from"node:url";const W=s=>{if(!s.includes("import")&&!s.includes("export"))return!1;try{return g(s)[3]}catch{return!0}},D=[".cts",".mts",".ts",".tsx",".jsx"],N=[".js",".cjs",".mjs"],l=Object.assign(Object.create(null),i._extensions),U=l[".js"],_=(s,e)=>{u?.send&&u.send({type:"dependency",path:e});const t=D.some(o=>e.endsWith(o)),r=N.some(o=>e.endsWith(o));if(!t&&!r)return U(s,e);let n=M.readFileSync(e,"utf8");if(e.endsWith(".cjs")){const o=P(e,n);o&&(n=d()?p(o):o.code)}else if(t||W(n)){const o=R(n,e,{tsconfigRaw:v?.(e)});n=d()?p(o):o.code}s._compile(n,e)};[".js",".ts",".tsx",".jsx"].forEach(s=>{l[s]=_}),Object.defineProperty(l,".mjs",{value:_,enumerable:!1});const w=`${h.sep}node_modules${h.sep}`,f=i._resolveFilename.bind(i),y=(s,e,t,r)=>{const n=j(s);if(e?.filename&&(F.test(e.filename)||O)&&n)for(const o of n)try{return f(o,e,t,r)}catch(a){const{code:c}=a;if(c!=="MODULE_NOT_FOUND"&&c!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw a}},E=(s,e,t,r)=>{if(console.log("resolveFilename",{request:s,parent:e,isMain:t,options:r}),s.startsWith("data:")){const a=s.indexOf("tsx-file=");if(a!==-1){const c=s.indexOf("?",a);return s.slice(a+9,c!==-1?c:void 0)}}const n=s.indexOf("?");if(n!==-1&&(s=s.slice(0,n)),s.startsWith(T)&&(s=A(s)),x&&!b(s)&&!e?.filename?.includes(w)){const a=x(s);for(const c of a){const m=y(c,e,t,r);if(m)return m;try{return f(c,e,t,r)}catch{}}}const o=y(s,e,t,r);return o||f(s,e,t,r)},I=()=>{const{sourceMapsEnabled:s}=process,{_extensions:e,_resolveFilename:t}=i;return S(process.env.TSX_TSCONFIG_PATH),process.setSourceMapsEnabled(!0),i._extensions=l,i._resolveFilename=E,()=>{s===!1&&process.setSourceMapsEnabled(!1),i._extensions=e,i._resolveFilename=t}};export{E as a,I as r};
