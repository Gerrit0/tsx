import r from"node:module";import{s as p,i as x,f as T,a as b,t as _,b as v,r as F,c as O,d as S,l as M}from"./resolve-ts-path-DUkQ8uuR.mjs";import g from"node:fs";import{p as P,t as R,a as A}from"./index-CKNv86dv.mjs";import{p as h}from"./client-Cg7nS93t.mjs";import u from"node:path";import{fileURLToPath as W}from"node:url";import{parse as w}from"node:querystring";const D=s=>{if(!s.includes("import")&&!s.includes("export"))return!1;try{return P(s)[3]}catch{return!0}},I=[".cts",".mts",".ts",".tsx",".jsx"],N=[".js",".cjs",".mjs"],f=Object.assign(Object.create(null),r._extensions),U=f[".js"],y=(s,e)=>{h?.send&&h.send({type:"dependency",path:e}),console.log("cjs load",{filePath:e,module:s});const n=I.some(o=>e.endsWith(o)),a=N.some(o=>e.endsWith(o));if(!n&&!a)return U(s,e);let t=g.readFileSync(e,"utf8");if(e.endsWith(".cjs")){const o=R(e,t);o&&(t=p()?x(o):o.code)}else if(n||D(t)){const o=A(t,e,{format:"cjs",platform:"node",tsconfigRaw:T?.(e)});console.log("transformed",{transformed:o}),t=p()?x(o):o.code}s._compile(t,e)};[".js",".ts",".tsx",".jsx"].forEach(s=>{f[s]=y}),Object.defineProperty(f,".mjs",{value:y,enumerable:!1});const L=`${u.sep}node_modules${u.sep}`,m=r._resolveFilename.bind(r),j=(s,e,n,a)=>{const t=F(s);if(e?.filename&&(O.test(e.filename)||S)&&t)for(const o of t)try{return m(o,e,n,a)}catch(c){const{code:i}=c;if(i!=="MODULE_NOT_FOUND"&&i!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw c}},E=(s,e,n,a)=>{if(s.startsWith("data:")){const c=s.indexOf("?");if(c!==-1){const i=s.slice(c+1),l=w(i);if(l["tsx-file"]){const d=l["tsx-file"];r._cache[d]=r._cache[s],s=d}}else return s}const t=s.indexOf("?");if(t!==-1&&(s=s.slice(0,t)),s.startsWith(b)&&(s=W(s)),_&&!v(s)&&!e?.filename?.includes(L)){const c=_(s);for(const i of c){const l=j(i,e,n,a);if(l)return l;try{return m(i,e,n,a)}catch{}}}const o=j(s,e,n,a);return o||m(s,e,n,a)},C=()=>{const{sourceMapsEnabled:s}=process,{_extensions:e,_resolveFilename:n}=r;return M(process.env.TSX_TSCONFIG_PATH),process.setSourceMapsEnabled(!0),r._extensions=f,r._resolveFilename=E,()=>{s===!1&&process.setSourceMapsEnabled(!1),r._extensions=e,r._resolveFilename=n}};export{E as a,C as r};
