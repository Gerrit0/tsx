"use strict";var i=require("node:module"),g=require("node:fs"),p=require("get-tsconfig"),u=require("./index-DTCJysGI.cjs"),n=require("./file-url-DUGADRxL.cjs"),h=require("./client-DjommMgI.cjs"),v=require("node:path"),E=require("node:url");const F=e=>{if(e.includes("import")||e.includes("export"))try{return u.parseEsm(e)[3]}catch{return!0}return!1},j=[".cts",".mts",".ts",".tsx",".jsx"],S=[".js",".cjs",".mjs"],T=n.tsconfig&&p.createFilesMatcher(n.tsconfig),f=Object.assign(Object.create(null),i._extensions),b=f[".js"],x=(e,s)=>{h.parent?.send&&h.parent.send({type:"dependency",path:s});const o=j.some(t=>s.endsWith(t)),c=S.some(t=>s.endsWith(t));if(!o&&!c)return b(e,s);let r=g.readFileSync(s,"utf8");if(s.endsWith(".cjs")){const t=u.transformDynamicImport(s,r);t&&(r=n.shouldApplySourceMap()?n.inlineSourceMap(t):t.code)}else if(o||F(r)){const t=u.transformSync(r,s,{tsconfigRaw:T?.(s)});r=n.shouldApplySourceMap()?n.inlineSourceMap(t):t.code}e._compile(r,s)};[".js",".ts",".tsx",".jsx"].forEach(e=>{f[e]=x}),Object.defineProperty(f,".mjs",{value:x,enumerable:!1});const O=/\.[cm]?tsx?$/,P=`${v.sep}node_modules${v.sep}`,_=n.tsconfig&&p.createPathsMatcher(n.tsconfig),d=i._resolveFilename.bind(i),y=(e,s,o,c)=>{const r=n.resolveTsPath(e);if(s?.filename&&(O.test(s.filename)||n.tsconfig?.config.compilerOptions?.allowJs)&&r)for(const t of r)try{return d(t,s,o,c)}catch(l){const{code:a}=l;if(a!=="MODULE_NOT_FOUND"&&a!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw l}},M=(e,s,o,c)=>{const r=e.indexOf("?");if(r!==-1&&(e=e.slice(0,r)),e.startsWith(n.fileUrlPrefix)&&(e=E.fileURLToPath(e)),_&&!n.isRelativePath(e)&&!s?.filename?.includes(P)){const l=_(e);for(const a of l){const m=y(a,s,o,c);if(m)return m;try{return d(a,s,o,c)}catch{}}}const t=y(e,s,o,c);return t||d(e,s,o,c)},R=()=>{const{sourceMapsEnabled:e}=process,{_extensions:s,_resolveFilename:o}=i;return process.setSourceMapsEnabled(!0),i._extensions=f,i._resolveFilename=M,()=>{e===!1&&process.setSourceMapsEnabled(!1),i._extensions=s,i._resolveFilename=o}};exports.register=R,exports.resolveFilename=M;
