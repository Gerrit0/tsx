import c from"node:module";import{MessageChannel as m}from"node:worker_threads";const f=t=>{const{sourceMapsEnabled:n}=process;process.setSourceMapsEnabled(!0);const{port1:e,port2:a}=new m;c.register(`./esm/index.mjs?${Date.now()}`,{parentURL:import.meta.url,data:{namespace:t?.namespace,port:a},transferList:[a]});const s=t?.onImport&&(o=>{o.type==="load"&&onImport(o.url)});return s&&e.on("message",s),()=>(n===!1&&process.setSourceMapsEnabled(!1),s&&e.off("message",s),e.postMessage("deactivate"),new Promise(o=>{const r=p=>{p.type==="deactivated"&&(console.log(22222),o(),e.off("message",r))};e.on("message",r)}))};export{f as r};
