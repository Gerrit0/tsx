import c from"module";import S from"fs";import{parseTsconfig as E,getTsconfig as M,createFilesMatcher as O,createPathsMatcher as j}from"get-tsconfig";import{p as b,t as g,a as P}from"./index-29948669.mjs";import{shouldApplySourceMap as _,inlineSourceMap as v}from"./source-map.mjs";import{p as T}from"./client-d4eccf9f.mjs";import p from"path";import{i as A,r as N}from"./is-relative-path-pattern-ce88a5ac.mjs";const R=e=>{if(e.includes("import")||e.includes("export"))try{return b(e)[3]}catch{return!0}return!1},I=/\.[cm]?tsx?$/,m=process.env.TSX_TSCONFIG_PATH?{path:p.resolve(process.env.TSX_TSCONFIG_PATH),config:E(process.env.TSX_TSCONFIG_PATH)}:M(),C=[".cts",".mts",".ts",".tsx",".jsx"],D=[".js",".cjs",".mjs"],h=m&&O(m),f={...c._extensions},G=f[".js"],x=(e,s)=>{var n;(n=T)!=null&&n.send&&T.send({type:"dependency",path:s});const r=C.some(o=>s.endsWith(o)),a=D.some(o=>s.endsWith(o));if(!r&&!a)return G(e,s);let t=S.readFileSync(s,"utf8");if(s.endsWith(".cjs")){const o=g(s,t);o&&(t=_()?v(o):o.code)}else if(r||R(t)){const o=P(t,s,{tsconfigRaw:h==null?void 0:h(s)});t=_()?v(o):o.code}e._compile(t,s)};[".js",".ts",".tsx",".jsx"].forEach(e=>{f[e]=x}),Object.defineProperty(f,".mjs",{value:x,enumerable:!1});const H=`${p.sep}node_modules${p.sep}`,y=m&&j(m),u=c._resolveFilename.bind(c),F=(e,s,n,r)=>{var a,t;const o=N(e);if(s!=null&&s.filename&&(I.test(s.filename)||(t=(a=m)==null?void 0:a.config.compilerOptions)!=null&&t.allowJs)&&o)for(const d of o)try{return u(d,s,n,r)}catch(i){const{code:l}=i;if(l!=="MODULE_NOT_FOUND"&&l!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw i}},X=(e,s,n,r)=>{var a;const t=e.indexOf("?");if(t!==-1&&(e=e.slice(0,t)),y&&!A.test(e)&&!((a=s==null?void 0:s.filename)!=null&&a.includes(H))){const d=y(e);for(const i of d){const l=F(i,s,n,r);if(l)return l;try{return u(i,s,n,r)}catch{}}}const o=F(e,s,n,r);return o||u(e,s,n,r)},w=()=>{const{sourceMapsEnabled:e}=process,{_extensions:s,_resolveFilename:n}=c;return process.setSourceMapsEnabled(!0),c._extensions=f,c._resolveFilename=X,()=>{e===!1&&process.setSourceMapsEnabled(!1),c._extensions=s,c._resolveFilename=n}};export{w as r};
