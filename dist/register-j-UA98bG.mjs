import p from"node:module";import{MessageChannel as c}from"node:worker_threads";const m=a=>{const{sourceMapsEnabled:o}=process;process.setSourceMapsEnabled(!0);const{port1:e,port2:r}=new c;return p.register(`./esm/index.mjs?${Date.now()}`,{parentURL:import.meta.url,data:{namespace:a?.namespace,port:r},transferList:[r]}),a?.onImport&&e.on("message",s=>{console.log("message",s)}),()=>(o===!1&&process.setSourceMapsEnabled(!1),e.postMessage("deactivate"),new Promise(s=>{const t=n=>{n==="deactivated"&&(s(),e.off("message",t))};e.on("message",t)}))};export{m as r};
