"use strict";var i=require("node:module"),t=require("./resolve-ts-path-VlOGJlUT.cjs"),E=require("node:fs"),m=require("./index-CL50QkGo.cjs"),x=require("./client-DjommMgI.cjs"),p=require("node:path"),T=require("node:url"),v=require("node:querystring");const F=e=>{if(!e.includes("import")&&!e.includes("export"))return!1;try{return m.parseEsm(e)[3]}catch{return!0}},S=[".cts",".mts",".ts",".tsx",".jsx"],j=[".js",".cjs",".mjs"],d=Object.assign(Object.create(null),i._extensions),b=d[".js"],h=(e,s)=>{x.parent?.send&&x.parent.send({type:"dependency",path:s});const n=S.some(r=>s.endsWith(r)),c=j.some(r=>s.endsWith(r));if(!n&&!c)return b(e,s);let o=E.readFileSync(s,"utf8");if(s.endsWith(".cjs")){const r=m.transformDynamicImport(s,o);r&&(o=t.shouldApplySourceMap()?t.inlineSourceMap(r):r.code)}else if(n||F(o)){const r=m.transformSync(o,s,{tsconfigRaw:t.fileMatcher?.(s)});o=t.shouldApplySourceMap()?t.inlineSourceMap(r):r.code}e._compile(o,s)};[".js",".ts",".tsx",".jsx"].forEach(e=>{d[e]=h}),Object.defineProperty(d,".mjs",{value:h,enumerable:!1});const M=`${p.sep}node_modules${p.sep}`,u=i._resolveFilename.bind(i),_=(e,s,n,c)=>{const o=t.resolveTsPath(e);if(s?.filename&&(t.tsExtensionsPattern.test(s.filename)||t.allowJs)&&o)for(const r of o)try{return u(r,s,n,c)}catch(l){const{code:a}=l;if(a!=="MODULE_NOT_FOUND"&&a!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw l}},y=(e,s,n,c)=>{if(console.log("resolveFilename",{request:e,parent:s,isMain:n,options:c}),e.startsWith("data:")){const l=e.indexOf("tsx-file=");if(l!==-1){const a=e.slice(l),f=v.parse(a)["tsx-file"];return console.log(1111,v.parse(a)["tsx-file"]),u(f,s,n,c)}return e}const o=e.indexOf("?");if(o!==-1&&(e=e.slice(0,o)),e.startsWith(t.fileUrlPrefix)&&(e=T.fileURLToPath(e)),t.tsconfigPathsMatcher&&!t.isRelativePath(e)&&!s?.filename?.includes(M)){const l=t.tsconfigPathsMatcher(e);for(const a of l){const f=_(a,s,n,c);if(f)return f;try{return u(a,s,n,c)}catch{}}}const r=_(e,s,n,c);return r||u(e,s,n,c)},O=()=>{const{sourceMapsEnabled:e}=process,{_extensions:s,_resolveFilename:n}=i;return t.loadTsconfig(process.env.TSX_TSCONFIG_PATH),process.setSourceMapsEnabled(!0),i._extensions=d,i._resolveFilename=y,()=>{e===!1&&process.setSourceMapsEnabled(!1),i._extensions=s,i._resolveFilename=n}};exports.register=O,exports.resolveFilename=y;
