import c from"node:module";import y from"node:fs";import{parseTsconfig as T,getTsconfig as _,createFilesMatcher as E,createPathsMatcher as P}from"get-tsconfig";import{p as j,t as M,a as g}from"./index-DiuW-CAd.mjs";import{s as u,i as h,f as b,a as A,r as N}from"./file-url-tbtyRuyi.mjs";import{p as S}from"./client-Cg7nS93t.mjs";import l from"node:path";import{fileURLToPath as I}from"node:url";const C=s=>{if(s.includes("import")||s.includes("export"))try{return j(s)[3]}catch{return!0}return!1},i=process.env.TSX_TSCONFIG_PATH?{path:l.resolve(process.env.TSX_TSCONFIG_PATH),config:T(process.env.TSX_TSCONFIG_PATH)}:_(),G=[".cts",".mts",".ts",".tsx",".jsx"],H=[".js",".cjs",".mjs"],R=i&&E(i),m=Object.assign(Object.create(null),c._extensions),X=m[".js"],x=(s,e)=>{S?.send&&S.send({type:"dependency",path:e});const n=G.some(o=>e.endsWith(o)),r=H.some(o=>e.endsWith(o));if(!n&&!r)return X(s,e);let t=y.readFileSync(e,"utf8");if(e.endsWith(".cjs")){const o=M(e,t);o&&(t=u()?h(o):o.code)}else if(n||C(t)){const o=g(t,e,{tsconfigRaw:R?.(e)});t=u()?h(o):o.code}s._compile(t,e)};[".js",".ts",".tsx",".jsx"].forEach(s=>{m[s]=x}),Object.defineProperty(m,".mjs",{value:x,enumerable:!1});const D=/\.[cm]?tsx?$/;process.env.TSX_TSCONFIG_PATH?(l.resolve(process.env.TSX_TSCONFIG_PATH),T(process.env.TSX_TSCONFIG_PATH)):_();const U=`${l.sep}node_modules${l.sep}`,v=i&&P(i),p=c._resolveFilename.bind(c),F=(s,e,n,r)=>{const t=N(s);if(e?.filename&&(D.test(e.filename)||i?.config.compilerOptions?.allowJs)&&t)for(const o of t)try{return p(o,e,n,r)}catch(f){const{code:a}=f;if(a!=="MODULE_NOT_FOUND"&&a!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw f}},O=(s,e,n,r)=>{const t=s.indexOf("?");if(t!==-1&&(s=s.slice(0,t)),s.startsWith(b)&&(s=I(s)),v&&!A(s)&&!e?.filename?.includes(U)){const f=v(s);for(const a of f){const d=F(a,e,n,r);if(d)return d;try{return p(a,e,n,r)}catch{}}}const o=F(s,e,n,r);return o||p(s,e,n,r)},W=()=>{const{sourceMapsEnabled:s}=process,{_extensions:e,_resolveFilename:n}=c;return process.setSourceMapsEnabled(!0),c._extensions=m,c._resolveFilename=O,()=>{s===!1&&process.setSourceMapsEnabled(!1),c._extensions=e,c._resolveFilename=n}};export{O as a,W as r};
