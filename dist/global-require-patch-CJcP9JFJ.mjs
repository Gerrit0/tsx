import c from"node:module";import j from"node:fs";import{p as b,t as F,a as v}from"./index-DiuW-CAd.mjs";import{s as d,i as p,f as M,a as O,t as u,b as T,r as S,c as R}from"./file-url-Bg8MxEGF.mjs";import{p as x}from"./client-Cg7nS93t.mjs";import h from"node:path";import{fileURLToPath as g}from"node:url";const P=s=>{if(s.includes("import")||s.includes("export"))try{return b(s)[3]}catch{return!0}return!1},A=[".cts",".mts",".ts",".tsx",".jsx"],D=[".js",".cjs",".mjs"],l=Object.assign(Object.create(null),c._extensions),U=l[".js"],_=(s,e)=>{x?.send&&x.send({type:"dependency",path:e});const n=A.some(t=>e.endsWith(t)),r=D.some(t=>e.endsWith(t));if(!n&&!r)return U(s,e);let o=j.readFileSync(e,"utf8");if(e.endsWith(".cjs")){const t=F(e,o);t&&(o=d()?p(t):t.code)}else if(n||P(o)){const t=v(o,e,{tsconfigRaw:M?.(e)});o=d()?p(t):t.code}s._compile(o,e)};[".js",".ts",".tsx",".jsx"].forEach(s=>{l[s]=_}),Object.defineProperty(l,".mjs",{value:_,enumerable:!1});const W=/\.[cm]?tsx?$/,w=`${h.sep}node_modules${h.sep}`,f=c._resolveFilename.bind(c),y=(s,e,n,r)=>{const o=S(s);if(e?.filename&&(W.test(e.filename)||R?.config.compilerOptions?.allowJs)&&o)for(const t of o)try{return f(t,e,n,r)}catch(i){const{code:a}=i;if(a!=="MODULE_NOT_FOUND"&&a!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw i}},E=(s,e,n,r)=>{const o=s.indexOf("?");if(o!==-1&&(s=s.slice(0,o)),s.startsWith(O)&&(s=g(s)),u&&!T(s)&&!e?.filename?.includes(w)){const i=u(s);for(const a of i){const m=y(a,e,n,r);if(m)return m;try{return f(a,e,n,r)}catch{}}}const t=y(s,e,n,r);return t||f(s,e,n,r)},L=()=>{const{sourceMapsEnabled:s}=process,{_extensions:e,_resolveFilename:n}=c;return process.setSourceMapsEnabled(!0),c._extensions=l,c._resolveFilename=E,()=>{s===!1&&process.setSourceMapsEnabled(!1),c._extensions=e,c._resolveFilename=n}};export{E as a,L as r};
