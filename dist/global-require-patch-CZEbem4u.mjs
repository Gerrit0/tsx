import a from"node:module";import{s as d,i as p,f as T,a as j,t as u,b as S,r as b,c as v,d as F,l as O}from"./resolve-ts-path-DUkQ8uuR.mjs";import M from"node:fs";import{p as g,t as R,a as A}from"./index-DiuW-CAd.mjs";import{p as x}from"./client-Cg7nS93t.mjs";import _ from"node:path";import{fileURLToPath as N}from"node:url";const P=e=>{if(!e.includes("import")&&!e.includes("export"))return!1;try{return g(e)[3]}catch{return!0}},D=[".cts",".mts",".ts",".tsx",".jsx"],U=[".js",".cjs",".mjs"],l=Object.assign(Object.create(null),a._extensions),W=l[".js"],y=(e,s)=>{console.log("transformer",{module:e,filePath:s}),x?.send&&x.send({type:"dependency",path:s});const n=D.some(o=>s.endsWith(o)),r=U.some(o=>s.endsWith(o));if(!n&&!r)return W(e,s);let t=M.readFileSync(s,"utf8");if(s.endsWith(".cjs")){const o=R(s,t);o&&(t=d()?p(o):o.code)}else if(n||P(t)){const o=A(t,s,{tsconfigRaw:T?.(s)});t=d()?p(o):o.code}console.log(JSON.stringify({filePath:s,code:t},null,2)),e._compile(t,s)};[".js",".ts",".tsx",".jsx"].forEach(e=>{l[e]=y}),Object.defineProperty(l,".mjs",{value:y,enumerable:!1});const w=`${_.sep}node_modules${_.sep}`,f=a._resolveFilename.bind(a),h=(e,s,n,r)=>{const t=b(e);if(s?.filename&&(v.test(s.filename)||F)&&t)for(const o of t)try{return f(o,s,n,r)}catch(i){const{code:c}=i;if(c!=="MODULE_NOT_FOUND"&&c!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw i}},E=(e,s,n,r)=>{const t=e.indexOf("?");if(t!==-1&&(e=e.slice(0,t)),e.startsWith(j)&&(e=N(e)),u&&!S(e)&&!s?.filename?.includes(w)){const i=u(e);for(const c of i){const m=h(c,s,n,r);if(m)return m;try{return f(c,s,n,r)}catch{}}}const o=h(e,s,n,r);return o||f(e,s,n,r)},I=()=>{const{sourceMapsEnabled:e}=process,{_extensions:s,_resolveFilename:n}=a;return O(process.env.TSX_TSCONFIG_PATH),process.setSourceMapsEnabled(!0),a._extensions=l,a._resolveFilename=E,()=>{e===!1&&process.setSourceMapsEnabled(!1),a._extensions=s,a._resolveFilename=n}};export{E as a,I as r};
