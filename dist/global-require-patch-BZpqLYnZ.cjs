"use strict";var a=require("node:module"),n=require("./resolve-ts-path-VlOGJlUT.cjs"),y=require("node:fs"),u=require("./index-DTCJysGI.cjs"),p=require("./client-DjommMgI.cjs"),h=require("node:path"),E=require("node:url");const T=e=>{if(!e.includes("import")&&!e.includes("export"))return!1;try{return u.parseEsm(e)[3]}catch{return!0}},M=[".cts",".mts",".ts",".tsx",".jsx"],S=[".js",".cjs",".mjs"],f=Object.assign(Object.create(null),a._extensions),j=f[".js"],v=(e,s)=>{p.parent?.send&&p.parent.send({type:"dependency",path:s});const o=M.some(t=>s.endsWith(t)),c=S.some(t=>s.endsWith(t));if(!o&&!c)return j(e,s);let r=y.readFileSync(s,"utf8");if(s.endsWith(".cjs")){const t=u.transformDynamicImport(s,r);t&&(r=n.shouldApplySourceMap()?n.inlineSourceMap(t):t.code)}else if(o||T(r)){const t=u.transformSync(r,s,{tsconfigRaw:n.fileMatcher?.(s)});r=n.shouldApplySourceMap()?n.inlineSourceMap(t):t.code}e._compile(r,s)};[".js",".ts",".tsx",".jsx"].forEach(e=>{f[e]=v}),Object.defineProperty(f,".mjs",{value:v,enumerable:!1});const F=`${h.sep}node_modules${h.sep}`,d=a._resolveFilename.bind(a),x=(e,s,o,c)=>{const r=n.resolveTsPath(e);if(s?.filename&&(n.tsExtensionsPattern.test(s.filename)||n.allowJs)&&r)for(const t of r)try{return d(t,s,o,c)}catch(l){const{code:i}=l;if(i!=="MODULE_NOT_FOUND"&&i!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw l}},_=(e,s,o,c)=>{const r=e.indexOf("?");if(r!==-1&&(e=e.slice(0,r)),e.startsWith(n.fileUrlPrefix)&&(e=E.fileURLToPath(e)),n.tsconfigPathsMatcher&&!n.isRelativePath(e)&&!s?.filename?.includes(F)){const l=n.tsconfigPathsMatcher(e);for(const i of l){const m=x(i,s,o,c);if(m)return m;try{return d(i,s,o,c)}catch{}}}const t=x(e,s,o,c);return t||d(e,s,o,c)},b=e=>{const{sourceMapsEnabled:s}=process,{_extensions:o,_resolveFilename:c}=a;n.loadTsconfig(process.env.TSX_TSCONFIG_PATH),process.setSourceMapsEnabled(!0),a._extensions=f,a._resolveFilename=_;const r=()=>{s===!1&&process.setSourceMapsEnabled(!1),a._extensions=o,a._resolveFilename=c};if(e?.namespace){const t=(l,i)=>{getRequestContext(l,i)};r.require=t,r.unregister=r}return r};exports.register=b,exports.resolveFilename=_;
