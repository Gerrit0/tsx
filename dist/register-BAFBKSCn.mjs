import p from"node:module";import{MessageChannel as c}from"node:worker_threads";const i=r=>{const{sourceMapsEnabled:a}=process;process.setSourceMapsEnabled(!0);const{port1:t,port2:s}=new c;if(p.register(`./esm/index.mjs?${Date.now()}`,{parentURL:import.meta.url,data:{namespace:r?.namespace,port:s},transferList:[s]}),r?.onImport){const{onImport:o}=r;t.on("message",e=>{e&&typeof e=="object"&&"type"in e&&e.type==="load"&&o(e.url)})}return()=>(a===!1&&process.setSourceMapsEnabled(!1),t.postMessage("deactivate"),new Promise(o=>{const e=n=>{n==="deactivated"&&(o(),t.off("message",e))};t.on("message",e)}))};export{i as r};
