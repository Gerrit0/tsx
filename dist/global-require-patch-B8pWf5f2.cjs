"use strict";var a=require("node:module"),o=require("./resolve-ts-path-VlOGJlUT.cjs"),y=require("node:fs"),m=require("./index-CL50QkGo.cjs"),p=require("./client-DjommMgI.cjs"),x=require("node:path"),E=require("node:url"),T=require("node:querystring");const j=e=>{if(!e.includes("import")&&!e.includes("export"))return!1;try{return m.parseEsm(e)[3]}catch{return!0}},F=[".cts",".mts",".ts",".tsx",".jsx"],S=[".js",".cjs",".mjs"],f=Object.assign(Object.create(null),a._extensions),g=f[".js"],v=(e,s)=>{p.parent?.send&&p.parent.send({type:"dependency",path:s}),console.log("cjs load",{filePath:s});const r=F.some(n=>s.endsWith(n)),c=S.some(n=>s.endsWith(n));if(!r&&!c){const n=g(e,s);return console.log("loaded",{loaded:n}),n}let t=y.readFileSync(s,"utf8");if(s.endsWith(".cjs")){const n=m.transformDynamicImport(s,t);n&&(t=o.shouldApplySourceMap()?o.inlineSourceMap(n):n.code)}else if(r||j(t)){const n=m.transformSync(t,s,{platform:"node",tsconfigRaw:o.fileMatcher?.(s)});console.log("transformed",{transformed:n}),t=o.shouldApplySourceMap()?o.inlineSourceMap(n):n.code}e._compile(t,s)};[".js",".ts",".tsx",".jsx"].forEach(e=>{f[e]=v}),Object.defineProperty(f,".mjs",{value:v,enumerable:!1});const M=`${x.sep}node_modules${x.sep}`,u=a._resolveFilename.bind(a),h=(e,s,r,c)=>{const t=o.resolveTsPath(e);if(s?.filename&&(o.tsExtensionsPattern.test(s.filename)||o.allowJs)&&t)for(const n of t)try{return u(n,s,r,c)}catch(l){const{code:i}=l;if(i!=="MODULE_NOT_FOUND"&&i!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw l}},_=(e,s,r,c)=>{if(console.log("resolveFilename",{request:e,parent:s,isMain:r,options:c}),e.startsWith("data:")){const l=e.indexOf("?");if(l!==-1){const i=e.slice(l+1),d=T.parse(i);d["tsx-file"]&&(e=d["tsx-file"])}else return e}const t=e.indexOf("?");if(t!==-1&&(e=e.slice(0,t)),e.startsWith(o.fileUrlPrefix)&&(e=E.fileURLToPath(e)),o.tsconfigPathsMatcher&&!o.isRelativePath(e)&&!s?.filename?.includes(M)){const l=o.tsconfigPathsMatcher(e);for(const i of l){const d=h(i,s,r,c);if(d)return d;try{return u(i,s,r,c)}catch{}}}const n=h(e,s,r,c);return n||u(e,s,r,c)},O=()=>{const{sourceMapsEnabled:e}=process,{_extensions:s,_resolveFilename:r}=a;return o.loadTsconfig(process.env.TSX_TSCONFIG_PATH),process.setSourceMapsEnabled(!0),a._extensions=f,a._resolveFilename=_,()=>{e===!1&&process.setSourceMapsEnabled(!1),a._extensions=s,a._resolveFilename=r}};exports.register=O,exports.resolveFilename=_;
