import m from"node:module";import{MessageChannel as i}from"node:worker_threads";const f=t=>{const{sourceMapsEnabled:p}=process;process.setSourceMapsEnabled(!0);const{port1:e,port2:r}=new i;m.register(`./esm/index.mjs?${Date.now()}`,{parentURL:import.meta.url,data:{namespace:t?.namespace,port:r},transferList:[r]});const a=t?.onImport,s=a&&(o=>{o.type==="load"&&a(o.url)});return s&&e.on("message",s),()=>(p===!1&&process.setSourceMapsEnabled(!1),s&&e.off("message",s),e.postMessage("deactivate"),new Promise(o=>{const n=c=>{c.type==="deactivated"&&(console.log(22222),o(),e.off("message",n))};e.on("message",n)}))};export{f as r};
