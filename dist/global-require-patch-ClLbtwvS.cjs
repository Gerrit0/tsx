"use strict";var i=require("node:module"),r=require("./resolve-ts-path-VlOGJlUT.cjs"),y=require("node:fs"),d=require("./index-CL50QkGo.cjs"),p=require("./client-DjommMgI.cjs"),h=require("node:path"),E=require("node:url");require("node:querystring");const T=e=>{if(!e.includes("import")&&!e.includes("export"))return!1;try{return d.parseEsm(e)[3]}catch{return!0}},F=[".cts",".mts",".ts",".tsx",".jsx"],S=[".js",".cjs",".mjs"],f=Object.assign(Object.create(null),i._extensions),j=f[".js"],v=(e,s)=>{p.parent?.send&&p.parent.send({type:"dependency",path:s});const o=F.some(n=>s.endsWith(n)),c=S.some(n=>s.endsWith(n));if(!o&&!c)return j(e,s);let t=y.readFileSync(s,"utf8");if(s.endsWith(".cjs")){const n=d.transformDynamicImport(s,t);n&&(t=r.shouldApplySourceMap()?r.inlineSourceMap(n):n.code)}else if(o||T(t)){const n=d.transformSync(t,s,{tsconfigRaw:r.fileMatcher?.(s)});t=r.shouldApplySourceMap()?r.inlineSourceMap(n):n.code}e._compile(t,s)};[".js",".ts",".tsx",".jsx"].forEach(e=>{f[e]=v}),Object.defineProperty(f,".mjs",{value:v,enumerable:!1});const M=`${h.sep}node_modules${h.sep}`,m=i._resolveFilename.bind(i),x=(e,s,o,c)=>{const t=r.resolveTsPath(e);if(s?.filename&&(r.tsExtensionsPattern.test(s.filename)||r.allowJs)&&t)for(const n of t)try{return m(n,s,o,c)}catch(a){const{code:l}=a;if(l!=="MODULE_NOT_FOUND"&&l!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw a}},_=(e,s,o,c)=>{if(console.log("resolveFilename",{request:e,parent:s,isMain:o,options:c}),e.startsWith("data:")){const a=e.indexOf("?");return a!==-1&&(console.log("trim before",{request:e}),e=e.slice(0,a),console.log("trimmed",{request:e})),e}const t=e.indexOf("?");if(t!==-1&&(e=e.slice(0,t)),e.startsWith(r.fileUrlPrefix)&&(e=E.fileURLToPath(e)),r.tsconfigPathsMatcher&&!r.isRelativePath(e)&&!s?.filename?.includes(M)){const a=r.tsconfigPathsMatcher(e);for(const l of a){const u=x(l,s,o,c);if(u)return u;try{return m(l,s,o,c)}catch{}}}const n=x(e,s,o,c);return n||m(e,s,o,c)},b=()=>{const{sourceMapsEnabled:e}=process,{_extensions:s,_resolveFilename:o}=i;return r.loadTsconfig(process.env.TSX_TSCONFIG_PATH),process.setSourceMapsEnabled(!0),i._extensions=f,i._resolveFilename=_,()=>{e===!1&&process.setSourceMapsEnabled(!1),i._extensions=s,i._resolveFilename=o}};exports.register=b,exports.resolveFilename=_;
