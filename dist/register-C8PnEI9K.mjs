import p from"node:module";import{MessageChannel as f}from"node:worker_threads";import{pathToFileURL as d}from"node:url";const u=(r,s,e)=>{const o=s.startsWith("file://")?s:d(s),t=new URL(r,o);return t.searchParams.set("tsx-namespace",e),t.toString()},l=r=>(s,e)=>{if(!e)throw new Error("The current file path (import.meta.url) must be provided in the second argument of tsImport()");return import(u(s,e,r))},g=r=>{if(!p.register)throw new Error(`This version of Node.js (${process.version}) does not support module.register(). Please upgrade to Node v18.9 or v20.6 and above.`);console.log(r);const{sourceMapsEnabled:s}=process;process.setSourceMapsEnabled(!0);const{port1:e,port2:o}=new f;p.register(`./esm/index.mjs?${Date.now()}`,{parentURL:import.meta.url,data:{port:o,namespace:r?.namespace,a:1,tsconfig:r?.tsconfig},transferList:[o]});const t=r?.onImport,a=t&&(c=>{c.type==="load"&&t(c.url)});a&&(e.on("message",a),e.unref());const n=()=>(s===!1&&process.setSourceMapsEnabled(!1),a&&e.off("message",a),e.postMessage("deactivate"),new Promise(c=>{const i=m=>{m.type==="deactivated"&&(c(),e.off("message",i))};e.on("message",i)}));return r?.namespace&&(n.import=l(r.namespace),n.unregister=n),n};export{g as r};
