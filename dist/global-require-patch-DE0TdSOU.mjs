import c from"node:module";import E from"node:fs";import{parseTsconfig as T,getTsconfig as _,createFilesMatcher as P,createPathsMatcher as g}from"get-tsconfig";import{p as j,t as M,a as b}from"./index-DiuW-CAd.mjs";import{s as u,i as h,f as A,a as N,r as I}from"./file-url-tbtyRuyi.mjs";import{p as S}from"./client-Cg7nS93t.mjs";import f from"node:path";import{fileURLToPath as C}from"node:url";const G=s=>{if(s.includes("import")||s.includes("export"))try{return j(s)[3]}catch{return!0}return!1},H=/\.[cm]?tsx?$/,x=process.env.TSX_TSCONFIG_PATH?{path:f.resolve(process.env.TSX_TSCONFIG_PATH),config:T(process.env.TSX_TSCONFIG_PATH)}:_(),R=[".cts",".mts",".ts",".tsx",".jsx"],X=[".js",".cjs",".mjs"],D=x&&P(x),l=Object.assign(Object.create(null),c._extensions),U=l[".js"],v=(s,e)=>{S?.send&&S.send({type:"dependency",path:e});const n=R.some(o=>e.endsWith(o)),r=X.some(o=>e.endsWith(o));if(!n&&!r)return U(s,e);let t=E.readFileSync(e,"utf8");if(e.endsWith(".cjs")){const o=M(e,t);o&&(t=u()?h(o):o.code)}else if(n||G(t)){const o=b(t,e,{tsconfigRaw:D?.(e)});t=u()?h(o):o.code}s._compile(t,e)};[".js",".ts",".tsx",".jsx"].forEach(s=>{l[s]=v}),Object.defineProperty(l,".mjs",{value:v,enumerable:!1});const m=process.env.TSX_TSCONFIG_PATH?{path:f.resolve(process.env.TSX_TSCONFIG_PATH),config:T(process.env.TSX_TSCONFIG_PATH)}:_(),W=`${f.sep}node_modules${f.sep}`,F=m&&g(m),p=c._resolveFilename.bind(c),O=(s,e,n,r)=>{const t=I(s);if(e?.filename&&(H.test(e.filename)||m?.config.compilerOptions?.allowJs)&&t)for(const o of t)try{return p(o,e,n,r)}catch(i){const{code:a}=i;if(a!=="MODULE_NOT_FOUND"&&a!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw i}},y=(s,e,n,r)=>{const t=s.indexOf("?");if(t!==-1&&(s=s.slice(0,t)),s.startsWith(A)&&(s=C(s)),F&&!N(s)&&!e?.filename?.includes(W)){const i=F(s);for(const a of i){const d=O(a,e,n,r);if(d)return d;try{return p(a,e,n,r)}catch{}}}const o=O(s,e,n,r);return o||p(s,e,n,r)},$=()=>{const{sourceMapsEnabled:s}=process,{_extensions:e,_resolveFilename:n}=c;return process.setSourceMapsEnabled(!0),c._extensions=l,c._resolveFilename=y,()=>{s===!1&&process.setSourceMapsEnabled(!1),c._extensions=e,c._resolveFilename=n}};export{y as a,$ as r};
