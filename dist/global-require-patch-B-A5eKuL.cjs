"use strict";var i=require("node:module"),n=require("./resolve-ts-path-VlOGJlUT.cjs"),y=require("node:fs"),d=require("./index-CL50QkGo.cjs"),p=require("./client-DjommMgI.cjs"),v=require("node:path"),E=require("node:url"),T=require("node:querystring");const F=e=>{if(!e.includes("import")&&!e.includes("export"))return!1;try{return d.parseEsm(e)[3]}catch{return!0}},S=[".cts",".mts",".ts",".tsx",".jsx"],j=[".js",".cjs",".mjs"],f=Object.assign(Object.create(null),i._extensions),M=f[".js"],h=(e,s)=>{p.parent?.send&&p.parent.send({type:"dependency",path:s});const t=S.some(r=>s.endsWith(r)),c=j.some(r=>s.endsWith(r));if(!t&&!c)return M(e,s);let o=y.readFileSync(s,"utf8");if(s.endsWith(".cjs")){const r=d.transformDynamicImport(s,o);r&&(o=n.shouldApplySourceMap()?n.inlineSourceMap(r):r.code)}else if(t||F(o)){const r=d.transformSync(o,s,{tsconfigRaw:n.fileMatcher?.(s)});o=n.shouldApplySourceMap()?n.inlineSourceMap(r):r.code}e._compile(o,s)};[".js",".ts",".tsx",".jsx"].forEach(e=>{f[e]=h}),Object.defineProperty(f,".mjs",{value:h,enumerable:!1});const O=`${v.sep}node_modules${v.sep}`,u=i._resolveFilename.bind(i),x=(e,s,t,c)=>{const o=n.resolveTsPath(e);if(s?.filename&&(n.tsExtensionsPattern.test(s.filename)||n.allowJs)&&o)for(const r of o)try{return u(r,s,t,c)}catch(a){const{code:l}=a;if(l!=="MODULE_NOT_FOUND"&&l!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw a}},_=(e,s,t,c)=>{if(console.log("resolveFilename",{request:e,parent:s,isMain:t,options:c}),e.startsWith("data:")){const a=e.indexOf("tsx-file=");a!==-1&&(e.slice(a),console.log(1111,T.parse(a)))}const o=e.indexOf("?");if(o!==-1&&(e=e.slice(0,o)),e.startsWith(n.fileUrlPrefix)&&(e=E.fileURLToPath(e)),n.tsconfigPathsMatcher&&!n.isRelativePath(e)&&!s?.filename?.includes(O)){const a=n.tsconfigPathsMatcher(e);for(const l of a){const m=x(l,s,t,c);if(m)return m;try{return u(l,s,t,c)}catch{}}}const r=x(e,s,t,c);return r||u(e,s,t,c)},b=()=>{const{sourceMapsEnabled:e}=process,{_extensions:s,_resolveFilename:t}=i;return n.loadTsconfig(process.env.TSX_TSCONFIG_PATH),process.setSourceMapsEnabled(!0),i._extensions=f,i._resolveFilename=_,()=>{e===!1&&process.setSourceMapsEnabled(!1),i._extensions=s,i._resolveFilename=t}};exports.register=b,exports.resolveFilename=_;
