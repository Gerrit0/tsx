import p from"node:module";import{MessageChannel as c}from"node:worker_threads";const m=r=>{const{sourceMapsEnabled:o}=process;process.setSourceMapsEnabled(!0);const{port1:s,port2:t}=new c;if(p.register(`./esm/index.mjs?${Date.now()}`,{parentURL:import.meta.url,data:{namespace:r?.namespace,port:t},transferList:[t]}),r?.onImport){const{onImport:a}=r;s.on("message",e=>{e.type==="load"&&a(e.url)}),t.unref()}return()=>(o===!1&&process.setSourceMapsEnabled(!1),s.postMessage("deactivate"),new Promise(a=>{const e=n=>{n.type==="deactivated"&&(a(),s.off("message",e))};s.on("message",e)}))};export{m as r};
