import c from"node:module";import{MessageChannel as p}from"node:worker_threads";const l=r=>{const{sourceMapsEnabled:t}=process;process.setSourceMapsEnabled(!0);const{port1:e,port2:o}=new p;return c.register(`./esm/index.mjs?${Date.now()}`,{parentURL:import.meta.url,data:{namespace:r?.namespace,port:o},transferList:[o]}),()=>(t===!1&&process.setSourceMapsEnabled(!1),console.log(1),e.postMessage("deactivate"),new Promise(a=>{console.log(2);const n=s=>{console.log(3),console.log({message:s}),s==="deactivated"&&a()};e.on("message",n),e.unref()}))};export{l as r};
