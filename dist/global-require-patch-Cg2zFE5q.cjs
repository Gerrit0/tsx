"use strict";var i=require("node:module"),y=require("node:fs"),d=require("./index-DTCJysGI.cjs"),o=require("./file-url-NS5QWZpF.cjs"),p=require("./client-DjommMgI.cjs"),h=require("node:path"),E=require("node:url");const M=e=>{if(e.includes("import")||e.includes("export"))try{return d.parseEsm(e)[3]}catch{return!0}return!1},j=[".cts",".mts",".ts",".tsx",".jsx"],F=[".js",".cjs",".mjs"],f=Object.assign(Object.create(null),i._extensions),S=f[".js"],x=(e,s)=>{p.parent?.send&&p.parent.send({type:"dependency",path:s});const t=j.some(r=>s.endsWith(r)),c=F.some(r=>s.endsWith(r));if(!t&&!c)return S(e,s);let n=y.readFileSync(s,"utf8");if(s.endsWith(".cjs")){const r=d.transformDynamicImport(s,n);r&&(n=o.shouldApplySourceMap()?o.inlineSourceMap(r):r.code)}else if(t||M(n)){const r=d.transformSync(n,s,{tsconfigRaw:o.fileMatcher?.(s)});n=o.shouldApplySourceMap()?o.inlineSourceMap(r):r.code}e._compile(n,s)};[".js",".ts",".tsx",".jsx"].forEach(e=>{f[e]=x}),Object.defineProperty(f,".mjs",{value:x,enumerable:!1});const b=/\.[cm]?tsx?$/,O=`${h.sep}node_modules${h.sep}`,u=i._resolveFilename.bind(i),v=(e,s,t,c)=>{const n=o.resolveTsPath(e);if(s?.filename&&(b.test(s.filename)||o.tsconfig?.config.compilerOptions?.allowJs)&&n)for(const r of n)try{return u(r,s,t,c)}catch(l){const{code:a}=l;if(a!=="MODULE_NOT_FOUND"&&a!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw l}},_=(e,s,t,c)=>{const n=e.indexOf("?");if(n!==-1&&(e=e.slice(0,n)),e.startsWith(o.fileUrlPrefix)&&(e=E.fileURLToPath(e)),o.tsconfigPathsMatcher&&!o.isRelativePath(e)&&!s?.filename?.includes(O)){const l=o.tsconfigPathsMatcher(e);for(const a of l){const m=v(a,s,t,c);if(m)return m;try{return u(a,s,t,c)}catch{}}}const r=v(e,s,t,c);return r||u(e,s,t,c)},T=()=>{const{sourceMapsEnabled:e}=process,{_extensions:s,_resolveFilename:t}=i;return process.setSourceMapsEnabled(!0),i._extensions=f,i._resolveFilename=_,()=>{e===!1&&process.setSourceMapsEnabled(!1),i._extensions=s,i._resolveFilename=t}};exports.register=T,exports.resolveFilename=_;
