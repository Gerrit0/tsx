"use strict";var c=require("node:module"),g=require("node:fs"),a=require("get-tsconfig"),m=require("./index-DTCJysGI.cjs"),i=require("./file-url-BcwMOquI.cjs"),v=require("./client-DjommMgI.cjs"),d=require("node:path"),y=require("node:url");const O=e=>{if(e.includes("import")||e.includes("export"))try{return m.parseEsm(e)[3]}catch{return!0}return!1},f=process.env.TSX_TSCONFIG_PATH?{path:d.resolve(process.env.TSX_TSCONFIG_PATH),config:a.parseTsconfig(process.env.TSX_TSCONFIG_PATH)}:a.getTsconfig(),M=[".cts",".mts",".ts",".tsx",".jsx"],E=[".js",".cjs",".mjs"],P=f&&a.createFilesMatcher(f),p=Object.assign(Object.create(null),c._extensions),j=p[".js"],S=(e,s)=>{v.parent?.send&&v.parent.send({type:"dependency",path:s});const t=M.some(r=>s.endsWith(r)),o=E.some(r=>s.endsWith(r));if(!t&&!o)return j(e,s);let n=g.readFileSync(s,"utf8");if(s.endsWith(".cjs")){const r=m.transformDynamicImport(s,n);r&&(n=i.shouldApplySourceMap()?i.inlineSourceMap(r):r.code)}else if(t||O(n)){const r=m.transformSync(n,s,{tsconfigRaw:P?.(s)});n=i.shouldApplySourceMap()?i.inlineSourceMap(r):r.code}e._compile(n,s)};[".js",".ts",".tsx",".jsx"].forEach(e=>{p[e]=S}),Object.defineProperty(p,".mjs",{value:S,enumerable:!1});const A=/\.[cm]?tsx?$/;process.env.TSX_TSCONFIG_PATH?(d.resolve(process.env.TSX_TSCONFIG_PATH),a.parseTsconfig(process.env.TSX_TSCONFIG_PATH)):a.getTsconfig();const b=`${d.sep}node_modules${d.sep}`,h=f&&a.createPathsMatcher(f),T=c._resolveFilename.bind(c),x=(e,s,t,o)=>{const n=i.resolveTsPath(e);if(s?.filename&&(A.test(s.filename)||f?.config.compilerOptions?.allowJs)&&n)for(const r of n)try{return T(r,s,t,o)}catch(u){const{code:l}=u;if(l!=="MODULE_NOT_FOUND"&&l!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw u}},F=(e,s,t,o)=>{const n=e.indexOf("?");if(n!==-1&&(e=e.slice(0,n)),e.startsWith(i.fileUrlPrefix)&&(e=y.fileURLToPath(e)),h&&!i.isRelativePath(e)&&!s?.filename?.includes(b)){const u=h(e);for(const l of u){const _=x(l,s,t,o);if(_)return _;try{return T(l,s,t,o)}catch{}}}const r=x(e,s,t,o);return r||T(e,s,t,o)},N=()=>{const{sourceMapsEnabled:e}=process,{_extensions:s,_resolveFilename:t}=c;return process.setSourceMapsEnabled(!0),c._extensions=p,c._resolveFilename=F,()=>{e===!1&&process.setSourceMapsEnabled(!1),c._extensions=s,c._resolveFilename=t}};exports.register=N,exports.resolveFilename=F;
