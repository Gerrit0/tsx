import p from"node:module";import{MessageChannel as c}from"node:worker_threads";const i=t=>{const{sourceMapsEnabled:a}=process;process.setSourceMapsEnabled(!0);const{port1:e,port2:s}=new c;return p.register(`./esm/index.mjs?${Date.now()}`,{parentURL:import.meta.url,data:{namespace:t?.namespace,port:s},transferList:[s]}),()=>(e.postMessage("deactivate"),a===!1&&process.setSourceMapsEnabled(!1),new Promise(o=>{const r=n=>{n==="deactivated"&&(o(),e.off("message",r))};e.on("message",r),e.unref()}))};export{i as r};
